<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile Page</title>
<style>
    body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    }
    header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background-color: #f4f4f4;
    border-bottom: 1px solid #ccc;
    }
    header button {
    margin: 0 5px;
    }
    main {
    padding: 20px;
    }
    .profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    }
    .profile-header img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    margin-right: 20px;
    }
    .profile-header div {
    font-size: 18px;
    }
    .info-box {
    display: flex;
    justify-content: space-between;
    }
    .info-box div {
    width: 48%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    overflow-y: auto;
    max-height: 200px;
    }
    .info-box .ai-records {
    background-color: #f9f9f9;
    }
    .info-box .comments-reviews {
    background-color: #eef9ff;
    }
    .scroll-bar {
    overflow-y: scroll;
    }
</style>
</head>
<body>
<script>
    $(document).ready(function() {
      // 사용자 개인정보를 가져오는 AJAX 요청
    $.ajax({
        url: 'http://127.0.0.1:8000/accounts/profile/api/', // 개인정보 요청 URL
        method: 'GET', // HTTP GET 메서드
        success: function(data) {
          // 요청이 성공적으로 처리된 경우
          // 받은 데이터는 data 변수에 담겨 있음

          // 사용자 이름, 이메일, 프로필 사진 등 화면에 표시
        $('#user-name').text(`${data.username}님 반갑습니다!`);
        $('#user-email').text(`이메일: ${data.email}`);
        $('#user-full-name').text(`전체 이름: ${data.full_name}`);
        $('#user-profile-picture').attr('src', data.profile_picture);
        },
        error: function(xhr, status, error) {
          // 요청이 실패한 경우 실행되는 함수
        console.error("Error fetching user data:", error);
        }
    });
    });
</script>
<header>
    <div>
    <a href="/"><button>메인</button></a>
    <span>시간</span>
    </div>
    <div>
    <button id="edit-profile-btn">프로필 수정</button>
    <button id="logout-btn">로그아웃</button>
    <button id="create-post-btn">글 작성</button>
    </div>
</header>
<main>
    <div class="profile-header">
    <img src="profile-placeholder.png" alt="프로필 사진" id="profile-image">
    <div>
        <p id="user-name">{{ username }}님 반갑습니다!</p>
        <p>팔로워 수: <span id="follower-count">0</span></p>
        <p>팔로우 수: <span id="following-count">0</span></p>
    </div>
    </div>
    <div class="info-box">
    <div class="ai-records">
        <h3>AI 대화 내용 기록</h3>
        <div class="scroll-bar" id="ai-records">
        <!-- AI 대화 기록 내용 추가 -->
        </div>
    </div>
    <div class="comments-reviews">
        <h3>본인이 쓴 댓글 및 리뷰</h3>
        <div class="scroll-bar" id="comments-reviews">
        <!-- 댓글 및 리뷰 내용 추가 -->
        </div>
        <h3>추천 누른 영화 / 좋아요 누른 영화</h3>
        <div class="scroll-bar" id="liked-movies">
        <!-- 좋아요 누른 영화 내용 추가 -->
        </div>
    </div>
    </div>
</main>

<script>
    // 페이지 로딩 시 프로필 정보 가져오기
    window.onload = function() {
    fetchProfile();
    };

    // 프로필 정보 GET 요청
    function fetchProfile() {
    fetch('/accounts/profile/', {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('access_token') // 토큰은 로컬 스토리지에서 가져옴
        }
    })
    .then(response => response.json())
    .then(data => {
        // 프로필 정보 업데이트
        document.getElementById('user-name').textContent = data.first_name + "님 반갑습니다!";
        document.getElementById('follower-count').textContent = data.followers_count;
        document.getElementById('following-count').textContent = data.following_count;
        
        // AI 기록, 댓글/리뷰, 좋아요 누른 영화 등 추가 작업
        document.getElementById('ai-records').textContent = data.ai_records.join("\n");  // 예시
        document.getElementById('comments-reviews').textContent = data.comments.join("\n");  // 예시
        document.getElementById('liked-movies').textContent = data.liked_movies.join("\n");  // 예시
    })
    .catch(error => console.error('Error fetching profile:', error));
    }

    // 프로필 수정 버튼 클릭 시
    document.getElementById('edit-profile-btn').onclick = function() {
    const newName = prompt("새 이름을 입력하세요:", "이름");
    if (newName) {
        updateProfile(newName);
    }
    };

    // 프로필 정보 수정 POST 요청
    function updateProfile(newName) {
    fetch('/accounts/profile/', {
        method: 'POST',
        headers: {
        'Authorization': 'Bearer ' + localStorage.getItem('access_token'),
        'Content-Type': 'application/json'
        },
        body: JSON.stringify({ first_name: newName })
    })
    .then(response => response.json())
    .then(data => {
        alert("프로필이 성공적으로 수정되었습니다.");
        fetchProfile(); // 수정 후 정보 새로 고침
    })
    .catch(error => console.error('Error updating profile:', error));
    }
</script>
</body>
</html>